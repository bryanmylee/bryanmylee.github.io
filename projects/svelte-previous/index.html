<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,null,{}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');</script><script defer src=/client/2a17d3e02b3ca6d1dcc5/main.js></script> <style>div.svelte-1c099vw{-webkit-mask-size:12px 4px;mask-size:12px 4px;-webkit-mask-repeat:repeat;mask-repeat:repeat}</style> <title>svelte-previous</title> <link href=/client/2a17d3e02b3ca6d1dcc5/main.js rel=preload crossorigin=use-credentials as=script><link href=/client/2a17d3e02b3ca6d1dcc5/projects_svelte$45previous.9.js rel=preload crossorigin=use-credentials as=script></head> <body class="bg-base text-white"> <div id=sapper> <nav class="bg-base border-b border-transparent fixed left-0 lg:pt-3 pb-3 right-0 top-0 transition-all z-10"><div class="relative font-mono"> <div class="flex max-w-screen-lg mx-auto items-stretch justify-between w-full"><a href=/ class="flex items-center cta-button"><h2 class="py-1 font-bold px-2">Bryan Lee </h2></a> <div class="flex bg-primary text-base"><a href=https://github.com/bryanmylee class="flex items-center bg-primary hover:bg-base hover:text-primary p-1 text-base"><svg class="fill-current h-8 w-8" viewBox="0 0 32 32"><path d="M 16 4 C 9.371094 4 4 9.371094 4 16 C 4 21.300781 7.4375 25.800781 12.207031 27.386719 C 12.808594 27.496094 13.027344 27.128906 13.027344 26.808594 C 13.027344 26.523438 13.015625 25.769531 13.011719 24.769531 C 9.671875 25.492188 8.96875 23.160156 8.96875 23.160156 C 8.421875 21.773438 7.636719 21.402344 7.636719 21.402344 C 6.546875 20.660156 7.71875 20.675781 7.71875 20.675781 C 8.921875 20.761719 9.554688 21.910156 9.554688 21.910156 C 10.625 23.746094 12.363281 23.214844 13.046875 22.910156 C 13.15625 22.132813 13.46875 21.605469 13.808594 21.304688 C 11.144531 21.003906 8.34375 19.972656 8.34375 15.375 C 8.34375 14.0625 8.8125 12.992188 9.578125 12.152344 C 9.457031 11.851563 9.042969 10.628906 9.695313 8.976563 C 9.695313 8.976563 10.703125 8.65625 12.996094 10.207031 C 13.953125 9.941406 14.980469 9.808594 16 9.804688 C 17.019531 9.808594 18.046875 9.941406 19.003906 10.207031 C 21.296875 8.65625 22.300781 8.976563 22.300781 8.976563 C 22.957031 10.628906 22.546875 11.851563 22.421875 12.152344 C 23.191406 12.992188 23.652344 14.0625 23.652344 15.375 C 23.652344 19.984375 20.847656 20.996094 18.175781 21.296875 C 18.605469 21.664063 18.988281 22.398438 18.988281 23.515625 C 18.988281 25.121094 18.976563 26.414063 18.976563 26.808594 C 18.976563 27.128906 19.191406 27.503906 19.800781 27.386719 C 24.566406 25.796875 28 21.300781 28 16 C 28 9.371094 22.628906 4 16 4 Z"></path></svg></a> <a href=https://www.linkedin.com/in/bryan-lee-min-yuan class="flex items-center bg-primary hover:bg-base hover:text-primary p-1 text-base"><svg class="fill-current h-8 w-8" viewBox="0 0 30 30"><path d="M24,4H6C4.895,4,4,4.895,4,6v18c0,1.105,0.895,2,2,2h18c1.105,0,2-0.895,2-2V6C26,4.895,25.105,4,24,4z M10.954,22h-2.95 v-9.492h2.95V22z M9.449,11.151c-0.951,0-1.72-0.771-1.72-1.72c0-0.949,0.77-1.719,1.72-1.719c0.948,0,1.719,0.771,1.719,1.719 C11.168,10.38,10.397,11.151,9.449,11.151z M22.004,22h-2.948v-4.616c0-1.101-0.02-2.517-1.533-2.517 c-1.535,0-1.771,1.199-1.771,2.437V22h-2.948v-9.492h2.83v1.297h0.04c0.394-0.746,1.356-1.533,2.791-1.533 c2.987,0,3.539,1.966,3.539,4.522V22z"></path></svg></a> <a href=mailto:bryanmylee@gmail.com class="flex items-center bg-primary hover:bg-base hover:text-primary p-1 text-base"><svg class="fill-current h-8 w-8" viewBox="0 0 24 24"><path d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6C22,4.89 21.1,4 20,4Z"></path></svg></a></div></div></div> <ul class="flex font-mono max-w-screen-lg mt-4 mx-auto"><li><a href=blog class="hover:text-primary \n font-normal transition-colors\n underline false\n"><div class=relative> <div class="py-1 px-3 relative">blog</div></div></a><li><a href=projects class="hover:text-primary \n font-normal transition-colors\n underline font-bold hover:text-base\n text-base"><div class=relative><div class="absolute inset-0 -z-1 bg-primary"></div> <div class="py-1 px-3 relative">projects</div></div></a><li><a href=skills class="hover:text-primary \n font-normal transition-colors\n underline false\n"><div class=relative> <div class="py-1 px-3 relative">skills</div></div></a><li><a href=experience class="hover:text-primary \n font-normal transition-colors\n underline false\n"><div class=relative> <div class="py-1 px-3 relative">experience</div></div></a><li><a href=contact class="hover:text-primary \n font-normal transition-colors\n underline false\n"><div class=relative> <div class="py-1 px-3 relative">contact</div></div></a></ul></nav> <div class=relative><div class="absolute inset-0"><main class="mx-auto max-w-screen-lg mt-28 my-0 p-3"> <div class="mx-auto my-10 prose space-y-3"><div class="font-mono text-center"><h2>svelte-previous</h2></div> <div class="text-center italic">Svelte Stores that remember previous values!</div> <img alt=svelte-previous class="mx-auto max-h-48" src=client/37664c860b72174a4e8d9fa85a44bbda.png> <div class="py-1 px-3 card leading-8"><p>Some time back, I was trying to re-create a <strong>fancy</strong> animation I had seen online.</div> <div class="py-1 px-3 card leading-8"><p>When doing so, I found myself needing the previous value of the text property when creating the transition. In fact, I realized that it was common to reference the old value of a property. However, there was no simple or clean solution at the time.</div> <div class="py-1 px-3 card leading-8"><p>I attempted to develop a package that provided that functionality in the most Svelte-like way! In Svelte, when we need custom behaviour from our data, we should use <a href=https://svelte.dev/tutorial/writable-stores>Svelte Stores</a>!</div> <div class="flex items-center font-mono h-12 justify-center"><div>computer science student</div></div> <pre><code class=language-html><span class=hljs-tag>&lt;<span class=hljs-name>script</span>></span><span class=javascript>
  <span class=hljs-keyword>const</span> [currentItem, previousItem] = usePrevious(<span class=hljs-string>'tech geek'</span>);
  <span class=hljs-built_in>setInterval</span>(<span class=hljs-function>() =></span> $currentItem = getNextItem(), <span class=hljs-number>3000</span>);
</span><span class=hljs-tag>&lt;/<span class=hljs-name>script</span>></span>

{#key $currentItem}
  <span class=hljs-tag>&lt;<span class=hljs-name>div</span> <span class=hljs-attr>in:backspaceAndType</span>=<span class=hljs-string>{{from:</span> $<span class=hljs-attr>previousItem</span>}}></span>
    {$currentItem}
  <span class=hljs-tag>&lt;/<span class=hljs-name>div</span>></span>
{/key}</code></pre> </div> <div class="flex my-10 justify-center"><a href=https://github.com/bryanmylee/svelte-previous class="font-bold cta-button italic p-3">Check it out on Github</a></div> <hr> <div class="mx-auto my-10 prose space-y-3"><div class="font-mono text-center"><h3>How it works</h3></div> <div class="py-1 px-3 card leading-8"><p>The package returns an array of stores — the first being a writable store and the rest being read-only.</div> <pre><code class=language-ts>  <span class=hljs-keyword>export</span> <span class=hljs-keyword>let</span> name = <span class=hljs-string>'bryan'</span>;
  <span class=hljs-keyword>const</span> [currentName, previousName] = withPrevious(name);</code></pre> <div class="py-1 px-3 card leading-8"><p>When the stores are initialized, an internal store is created to keep track of all revisions made to the value. When the value is updated, we only have to increase the index of all revisions by one, and add the new value to the head of the array.</div> <div class="py-1 px-3 card leading-8"><p>To create individual stores from the array store, we can use an underlooked feature of Svelte Stores — <a href=https://svelte.dev/tutorial/derived-stores>derived stores</a>.</div> <div class="py-1 px-3 card leading-8"><p>We can simply derive stores for each element of the array, and give the first store a <code>set</code> and <code>update</code> function to make it a writable store.</div></div> <hr> <div class="mx-auto my-10 prose space-y-3"><div class="font-mono text-center"><h3>Lessons learnt</h3></div> <div></div> <div class="py-1 px-3 card leading-8"><p>This project was written in <strong>Typescript</strong>, as I truly enjoy the powerful type system. It also gave me another chance to brush up on my understanding of <strong>Svelte</strong> and the state management functionality provided by stores.</div> <div class="py-1 px-3 card leading-8"><p>More importantly, this project reminded me that the most crucial step in designing a package is the planning phase before any code is written.</div> <div class="py-1 px-3 card leading-8"><p>From the start, I knew that I did not want a difference in data type between writing a value and reading the value from the store. Therefore, I ruled out such an interface early on:</div> <pre><code class=language-ts>  $name = <span class=hljs-string>'adam'</span>;
  <span class=hljs-built_in>console</span>.log($name); <span class=hljs-comment>// { current: 'adam', previous: 'bryan' }</span></code></pre> <div class="py-1 px-3 card leading-8">I toyed with the idea of providing a <code>.setCurrent</code> method on the store:</div> <pre><code class=language-ts>  name.setCurrent(<span class=hljs-string>'adam'</span>);
  <span class=hljs-built_in>console</span>.log($name); <span class=hljs-comment>// { current: 'adam', previous: 'bryan' }</span></code></pre> <div class="py-1 px-3 card leading-8"><p>However, the syntax becomes awkward, and it is <strong>easy to make mistakes</strong> when setting the current value. Ultimately, I decided on using a helper function to instantiate multiple stores that would be coupled together, which produced the current API design.</div> </div></main></div></div></div> 