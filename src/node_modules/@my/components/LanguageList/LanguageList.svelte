<script lang="ts" context="module">
  export interface ImportedSvg {
    default: string;
  }
</script>

<script lang="ts">
  import InteractionObserver from '@my/components/InteractionObserver';
  import { fade } from 'svelte/transition';
  import { quadIn } from 'svelte/easing';

  export { className as class };
  let className = '';

  export let languages: string[] = [];
  $: icons = languages
      .map(async lang => {
        const data = import(`@my/assets/lang-icons/${lang}.svg`) as Promise<ImportedSvg>;
        return {
          lang,
          data: (await data).default,
        };
      });

  $: maxIndex = languages.length;
  const AVG_DELAY = 200;
  const getDelay = (index: number) => {
    const ratio = index / maxIndex;
    const easedRatio = quadIn(ratio);
    const delay = AVG_DELAY * easedRatio * maxIndex;
    // Add an additional average to delay for index = 0.
    // Don't add to the ratio before the easing function, as that causes a
    // difference in the initial delay.
    return delay + AVG_DELAY;
  }
</script>

<InteractionObserver let:percent let:unobserve>
  {#if percent > 90}
    <div class={className} use:unobserve>
      {#each icons as icon, index}
        {#await icon then { lang, data }}
          <img
            src={data}
            alt={lang}
            in:fade={{delay:getDelay(index)}}
            class="w-6 h-6"
            >
        {/await}
      {/each}
    </div>
  {/if}
</InteractionObserver>

