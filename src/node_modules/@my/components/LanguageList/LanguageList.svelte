<script lang="ts">
  import IntersectionObserver from '@my/components/IntersectionObserver';
  import { fade } from 'svelte/transition';
  import { quadIn } from 'svelte/easing';

  export { className as class };
  let className = '';

  export let tech: string[] = [];
  $: icons = tech
      .map(async t => {
        const data = (await import(`@my/assets/tech-icons/${t}.svg`)).default as string;
        return { tech: t, data };
      });

  $: maxIndex = tech.length;
  const AVG_DELAY = 200;
  const getDelay = (index: number) => {
    const ratio = index / maxIndex;
    const easedRatio = quadIn(ratio);
    const delay = AVG_DELAY * easedRatio * maxIndex;
    // Add an additional average to delay for index = 0.
    // Don't add to the ratio before the easing function, as that causes a
    // difference in the initial delay.
    return delay + AVG_DELAY;
  }
</script>

<IntersectionObserver let:percent let:unobserve>
  {#if percent > 90}
    <div class={className} use:unobserve>
      {#each icons as icon, index}
        {#await icon then { tech, data }}
          <img
            src={data}
            alt={tech}
            in:fade={{delay:getDelay(index)}}
            class="w-6 h-6"
            >
        {/await}
      {/each}
    </div>
  {/if}
</IntersectionObserver>

